<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Olympic Money Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .usa-sticky { position: sticky; top: 0; z-index: 100; background: white; border-bottom: 4px solid #002868; }
        .spoiler-blur { filter: blur(6px); transition: 0.3s; cursor: pointer; }
        .spoiler-blur.off { filter: none; }
        .money-text { color: #16a34a; font-family: 'Courier New', monospace; font-weight: 800; }
        .usa-row { background: #f0f7ff; border-left: 4px solid #bf0a30; }
        .loader { border-top-color: #002868; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 text-slate-900 pb-10">

    <!-- STICKY USA EARNINGS HEADER -->
    <header class="usa-sticky shadow-lg px-4 py-4">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div>
                <div class="bg-blue-900 text-white px-2 py-0.5 rounded text-[10px] font-black italic mb-1 w-fit uppercase tracking-tighter">Team USA Total Payouts</div>
                <div class="text-2xl font-black money-text" id="usa-total-cash">$0</div>
            </div>
            <div class="text-right">
                <span class="text-[10px] font-bold text-slate-400 uppercase block">Spoilers</span>
                <input type="checkbox" id="spoiler-toggle" class="w-10 h-5 mt-1">
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4">
        
        <!-- LOADING STATE -->
        <div id="loading" class="flex flex-col items-center py-20">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
            <p class="text-xs font-bold text-slate-400 uppercase">Fetching Live Medal Data...</p>
        </div>

        <!-- LEADERBOARD -->
        <div id="content" class="hidden space-y-6">
            <section>
                <h2 class="text-sm font-black uppercase mb-3 text-slate-500 tracking-tight">Cumulative Earnings Leaderboard</h2>
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <table class="w-full text-left text-xs">
                        <thead class="bg-slate-50 border-b font-bold text-slate-500 uppercase">
                            <tr>
                                <th class="p-4">Athlete</th>
                                <th class="p-4">Medals</th>
                                <th class="p-4 text-right">Earnings</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body"></tbody>
                    </table>
                </div>
            </section>
        </div>
    </main>

    <script>
        // OFFICIAL 2026 PAYOUT RATES (USD)
        const PAYOUT_RATES = {
            "USA": { g: 37500, s: 22500, b: 15000 },
            "ITA": { g: 212000, s: 106000, b: 71000 },
            "HKG": { g: 768000, s: 384000, b: 192000 },
            "SGP": { g: 737000, s: 369000, b: 184000 },
            "FRA": { g: 87000, s: 43000, b: 22000 },
            "GER": { g: 22000, s: 16000, b: 11000 },
            "NOR": { g: 0, s: 0, b: 0 } // Norway pays $0
        };

        let showSpoilers = false;
        let athleteData = [];

        async function init() {
            try {
                // We fetch from the 'medals' endpoint which contains every medal event and its winners
                const response = await fetch('https://apis.codante.io/olympic-games/medals');
                const json = await response.json();
                
                processData(json.data);
                render();
                
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
            } catch (error) {
                console.error("API Error:", error);
                document.getElementById('loading').innerHTML = "Error loading live data. Please try again later.";
            }
        }

        function processData(medals) {
            const athletes = {};

            medals.forEach(item => {
                // The API provides 'winner_name' and 'country_id'
                if (!item.winner_name || item.winner_name === "TBD") return;

                const name = item.winner_name;
                const country = item.country_id;
                const medalType = item.medal_type; // 'gold', 'silver', 'bronze'

                if (!athletes[name]) {
                    athletes[name] = { name, country, g: 0, s: 0, b: 0 };
                }

                if (medalType === 'gold') athletes[name].g++;
                if (medalType === 'silver') athletes[name].s++;
                if (medalType === 'bronze') athletes[name].b++;
            });

            athleteData = Object.values(athletes).map(a => {
                const rates = PAYOUT_RATES[a.country] || { g: 20000, s: 15000, b: 10000 };
                const earnings = (a.g * rates.g) + (a.s * rates.s) + (a.b * rates.b);
                return { ...a, earnings };
            }).sort((a, b) => b.earnings - a.earnings);
        }

        function render() {
            // Update USA Total
            const usaTotal = athleteData
                .filter(a => a.country === 'USA')
                .reduce((sum, a) => sum + a.earnings, 0);
            document.getElementById('usa-total-cash').innerText = `$${usaTotal.toLocaleString()}`;

            // Render Leaderboard
            const body = document.getElementById('leaderboard-body');
            body.innerHTML = athleteData.slice(0, 100).map(a => `
                <tr class="${a.country === 'USA' ? 'usa-row' : 'border-b border-slate-50'}">
                    <td class="p-4">
                        <div class="font-black text-sm uppercase tracking-tighter">${a.name}</div>
                        <div class="text-[10px] text-slate-400 font-bold">${a.country}</div>
                    </td>
                    <td class="p-4">
                        <div class="flex gap-1">
                            ${a.g > 0 ? `<span class="w-3 h-3 rounded-full bg-yellow-400 shadow-sm border border-yellow-500"></span>`.repeat(a.g) : ''}
                            ${a.s > 0 ? `<span class="w-3 h-3 rounded-full bg-slate-300 shadow-sm border border-slate-400"></span>`.repeat(a.s) : ''}
                            ${a.b > 0 ? `<span class="w-3 h-3 rounded-full bg-orange-400 shadow-sm border border-orange-500"></span>`.repeat(a.b) : ''}
                        </div>
                    </td>
                    <td class="p-4 text-right">
                        <div class="money-text text-sm ${showSpoilers ? '' : 'spoiler-blur'}">
                            $${a.earnings.toLocaleString()}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        document.getElementById('spoiler-toggle').addEventListener('change', (e) => {
            showSpoilers = e.target.checked;
            render();
        });

        init();
    </script>
</body>
</html>
